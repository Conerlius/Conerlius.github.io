---
layout:     article
title:      "c++编译"
subtitle:   " \"编译\""
date:       2021-03-11 18:00:00
author:     "Conerlius"
category: c++
keywords: c++
tags:
    - c++
---

## 纲要

- C++的编译过程
- 编译环境

## C++的编译过程

```flow
st=>start: *.cpp
cpp2expand=>subroutine: Preoprocessing :g++ -E
expandfile=>operation: *.i,包含头文件，展开宏
expand2compilation=>subroutine: compilation :g++ -S
compilationfile=>operation: *.s,汇编文件
compilation2assembly=>subroutine: assembly :g++ -c
assemblyfile=>operation: *.o(.obj),机器码
assembly2library=>subroutine: Linking (.a,.lib):g++
libraryfile=>operation: *.exe,机器程序
e=>end

st->cpp2expand->expandfile
expandfile->expand2compilation->compilationfile
compilationfile->compilation2assembly->assemblyfile
assemblyfile->assembly2library->libraryfile->e
```

如果使用的是gcc,需要指定一下`-lstdc++`,`gcc`和`g++`其中一个差别就`gcc`不会link标准库

![png](/images/c++/gcc_compiler.png)

gcc/g++ 头文件展开，宏替换、去注释

```
g++ -E hello.cpp -o hello.i
```
展开后，原本的代码放置在最后（保留行号，去注释）,如果不想去掉注释，可以结合`-C` (`C`是大写，小写有其他含义)使用

![png](/images/c++/gcc_compiler1.png)

```
g++ -S hello.i -o hello.s
```
生成汇编文件

![png](/images/c++/gcc_compiler2.png)

```
g++ -c hello.s -o hello.o
```
生成二进制文件

![png](/images/c++/gcc_compiler3.png)

```
g++ hello.o -o hello
```
生成执行文件

## 编译环境

- `msys2`
- `gcc/g++`
- Windows环境
- makefile

### msys2

在这篇幅里就不直接说`IDE`的，关注的是比较原始的方式。

由于目前是基于`windows`下的，所以使用的是`msys2`环境；

#### 安装和使用`msys2`

从[http://www.msys2.org/](http://www.msys2.org/)下载`MSYS2`。

安装后，最好更新所有软件包。使用以下命令更新所有内容：

```pacman
pacman -Syu
```

#### 镜像

如果当前网络更新或者下载较慢，可以考虑跟换镜像地址。三个文件`mirrorlist.mingw32`、`mirrorlist.msys`、`mirrorlist.mingw64`

`mirrorlist.mingw32`

```
# C:\msys64\etc\pacman.d\mirrorlist.mingw32
##
## 32-bit Mingw-w64 repository mirrorlist
##

## Primary
##中国科学技术大学开源软件镜像
Server = http://mirrors.ustc.edu.cn/msys2/mingw/i686
##北京理工大学镜像
Server = http://mirror.bit.edu.cn/msys2/mingw/i686
##日本北陆先端科学技术大学院大学 sourceforge 镜像
Server = http://jaist.dl.sourceforge.net/project/msys2/REPOS/MINGW/i686
##The UK Mirror Service Sourceforge mirror
Server = http://www.mirrorservice.org/sites/download.sourceforge.net/pub/sourceforge/m/ms/msys2/REPOS/MINGW/i686
## Primary
Server = ftp://148.251.42.38/MINGW/i686
## Sourceforge.net
Server = http://downloads.sourceforge.net/project/msys2/REPOS/MINGW/i686

## msys2.org
Server = http://repo.msys2.org/mingw/i686/
Server = https://sourceforge.net/projects/msys2/files/REPOS/MINGW/i686/
Server = http://www2.futureware.at/~nickoe/msys2-mirror/mingw/i686/
Server = https://mirror.yandex.ru/mirrors/msys2/mingw/i686/
```

`mirrorlist.msys`

```
# C:\msys64\etc\pacman.d\mirrorlist.msys
##
## MSYS2 repository mirrorlist
##

## Primary
##中国科学技术大学开源软件镜像
Server = http://mirrors.ustc.edu.cn/msys2/msys/$arch
##北京理工大学镜像
Server = http://mirror.bit.edu.cn/msys2/mingw/$arch
##日本北陆先端科学技术大学院大学 sourceforge 镜像
Server = http://jaist.dl.sourceforge.net/project/msys2/REPOS/MINGW/$arch
##The UK Mirror Service Sourceforge mirror
Server = http://www.mirrorservice.org/sites/download.sourceforge.net/pub/sourceforge/m/ms/msys2/REPOS/MSYS2/$arch
## Primary
Server = ftp://148.251.42.38/MSYS2/$arch
## Sourceforge.net
Server = http://downloads.sourceforge.net/project/msys2/REPOS/MSYS2/$arch

## msys2.org
Server = http://repo.msys2.org/msys/$arch/
Server = https://sourceforge.net/projects/msys2/files/REPOS/MSYS2/$arch/
Server = http://www2.futureware.at/~nickoe/msys2-mirror/msys/$arch/
Server = https://mirror.yandex.ru/mirrors/msys2/msys/$arch/
```

`mirrorlist.mingw64`

```
# C:\msys64\etc\pacman.d\mirrorlist.mingw64
##
## 64-bit Mingw-w64 repository mirrorlist
##

## Primary
##中国科学技术大学开源软件镜像
Server = http://mirrors.ustc.edu.cn/msys2/mingw/x86_64
##北京理工大学镜像
Server = http://mirror.bit.edu.cn/msys2/mingw/x86_64
##日本北陆先端科学技术大学院大学 sourceforge 镜像
Server = http://jaist.dl.sourceforge.net/project/msys2/REPOS/MINGW/x86_64
##The UK Mirror Service Sourceforge mirror
Server = http://www.mirrorservice.org/sites/download.sourceforge.net/pub/sourceforge/m/ms/msys2/REPOS/MINGW/x86_64
## Primary
Server = ftp://148.251.42.38/MINGW/x86_64
## Sourceforge.net
Server = http://downloads.sourceforge.net/project/msys2/REPOS/MINGW/x86_64

## msys2.org
Server = http://repo.msys2.org/mingw/x86_64/
Server = https://sourceforge.net/projects/msys2/files/REPOS/MINGW/x86_64/
Server = http://www2.futureware.at/~nickoe/msys2-mirror/mingw/x86_64/
Server = https://mirror.yandex.ru/mirrors/msys2/mingw/x86_64/
```

### gcc/g++

在`MSYS2 bash shell`中执行一下指令

```pacman
pacman -S base-devel gcc vim cmake
```

### Windows环境

上文中安装的`gcc/g++`都可以在`C\msys64\usr\bin`目录中找到许多`exe`文件。

如果需要在`window`下使用gcc之类的指令，只需要在`Path`中添加一下路径就可以了！

```cmd
C:\msys64\mingw64\bin
C:\msys64\usr\bin
```

### makefile

使用`gcc/g++`的时候，如果有大量的文件，那么在便利上就没有`make`来得爽了！

正在写……

